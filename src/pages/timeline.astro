---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const publications = await getCollection('publications');
const sortedPubs = publications.sort((a, b) => a.data.date.getTime() - b.data.date.getTime());

// Group by year
const pubsByYear = sortedPubs.reduce((acc, pub) => {
  const year = pub.data.year;
  if (!acc[year]) acc[year] = [];
  acc[year].push(pub);
  return acc;
}, {} as Record<number, typeof publications>);
---

<BaseLayout title="Timeline | Accessible IoT">
  <div class="container">
    <h1>Research Timeline</h1>
    <p class="intro">Evolution of our research from 2021-2025 under JST Presto Grant JPMJPR2132</p>

    <div class="timeline">
      {Object.entries(pubsByYear).map(([year, pubs]) => (
        <div class="timeline-year">
          <div class="year-marker">
            <span class="year-label">{year}</span>
            <span class="year-count">{pubs.length} publication{pubs.length !== 1 ? 's' : ''}</span>
          </div>

          <div class="year-content">
            {pubs.map(pub => (
              <div class="timeline-event">
                <div class="event-date">{pub.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                <div class="event-content">
                  <h3 class="event-title">{pub.data.title}</h3>
                  <p class="event-venue">{pub.data.venue}</p>
                  <div class="event-themes">
                    {pub.data.themes.map(theme => (
                      <span class="theme-badge">{theme}</span>
                    ))}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>

    <section class="milestones">
      <h2>Key Milestones</h2>
      <div class="milestone-grid">
        <div class="milestone-card">
          <div class="milestone-year">2021</div>
          <div class="milestone-title">Grant Start</div>
          <p>JST Presto Grant JPMJPR2132 begins, focusing on accessibility assessment tools for IoT</p>
        </div>

        <div class="milestone-card">
          <div class="milestone-year">2022</div>
          <div class="milestone-title">First Major Publication</div>
          <p>UIST 2022: Smart glasses-based visual impairment simulation</p>
        </div>

        <div class="milestone-card">
          <div class="milestone-year">2023</div>
          <div class="milestone-title">Research Expansion</div>
          <p>CHI 2023: Robotic avatars for disabled workers - demonstrating real-world impact</p>
        </div>

        <div class="milestone-card">
          <div class="milestone-year">2024</div>
          <div class="milestone-title">Peak Productivity</div>
          <p>Multiple publications at CHI, UbiComp, and ETRA</p>
        </div>

        <div class="milestone-card">
          <div class="milestone-year">2025</div>
          <div class="milestone-title">Project Culmination</div>
          <p>9 publications showcasing diverse accessibility and inclusive design research</p>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .intro {
    font-size: 1.125rem;
    color: var(--color-muted);
    margin-bottom: calc(var(--spacing-unit) * 8);
  }

  .timeline {
    margin-bottom: calc(var(--spacing-unit) * 10);
  }

  .timeline-year {
    margin-bottom: calc(var(--spacing-unit) * 8);
    position: relative;
  }

  .year-marker {
    display: flex;
    align-items: baseline;
    gap: calc(var(--spacing-unit) * 2);
    margin-bottom: calc(var(--spacing-unit) * 4);
    padding-bottom: calc(var(--spacing-unit) * 2);
    border-bottom: 2px solid var(--color-surface);
  }

  .year-label {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-secondary);
  }

  .year-count {
    color: var(--color-muted);
    font-size: 0.875rem;
  }

  .year-content {
    display: grid;
    gap: calc(var(--spacing-unit) * 3);
    padding-left: calc(var(--spacing-unit) * 4);
    border-left: 2px solid var(--color-selection);
  }

  .timeline-event {
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: calc(var(--spacing-unit) * 3);
    position: relative;
  }

  .timeline-event::before {
    content: '';
    position: absolute;
    left: -22px;
    top: 8px;
    width: 12px;
    height: 12px;
    background-color: var(--color-primary);
    border: 2px solid var(--color-background);
    border-radius: 50%;
  }

  .event-date {
    color: var(--color-muted);
    font-size: 0.875rem;
    padding-top: 4px;
  }

  .event-content {
    background-color: var(--color-surface);
    padding: calc(var(--spacing-unit) * 3);
  }

  .event-title {
    color: var(--color-foreground);
    font-size: 1.125rem;
    margin-bottom: calc(var(--spacing-unit) * 1);
  }

  .event-title::before,
  .event-title::after {
    content: none;
  }

  .event-venue {
    color: var(--color-cyan);
    font-weight: 700;
    margin-bottom: calc(var(--spacing-unit) * 2);
  }

  .event-themes {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-unit);
  }

  .theme-badge {
    padding: 4px calc(var(--spacing-unit) * 1.5);
    background-color: var(--color-background);
    color: var(--color-secondary);
    font-size: 0.75rem;
    border: 1px solid var(--color-selection);
  }

  .milestones {
    margin-top: calc(var(--spacing-unit) * 10);
  }

  .milestone-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: calc(var(--spacing-unit) * 3);
    margin-top: calc(var(--spacing-unit) * 4);
  }

  .milestone-card {
    padding: calc(var(--spacing-unit) * 4);
    background-color: var(--color-surface);
    border-left: 4px solid var(--color-success);
  }

  .milestone-year {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-success);
    margin-bottom: calc(var(--spacing-unit) * 1);
  }

  .milestone-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: calc(var(--spacing-unit) * 2);
  }

  .milestone-card p {
    color: var(--color-muted);
    line-height: 1.6;
  }

  @media (max-width: 768px) {
    .timeline-event {
      grid-template-columns: 1fr;
    }

    .year-content {
      padding-left: calc(var(--spacing-unit) * 2);
    }
  }
</style>
